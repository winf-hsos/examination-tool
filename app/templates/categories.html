{% extends "base.html" %}

{% block title %}Kategorien · Examination Tool{% endblock %}

{% block content %}
  <h1 class="page-title">Kategorien verwalten</h1>

  <div class="form-card" style="margin-bottom:2rem;">
    <form method="post" action="/categories">
      <div class="form-field">
        <label for="new-category-name">Neue Hauptkategorie</label>
        <input id="new-category-name" type="text" name="name" placeholder="z. B. Analysis" required />
      </div>
      <div class="form-actions">
        <button class="button" type="submit">Kategorie anlegen</button>
      </div>
    </form>
  </div>

  {% if not categories %}
    <div class="card">
      <p>Noch keine Kategorien vorhanden. Lege eine erste Hauptkategorie an, um Aufgaben zu strukturieren.</p>
    </div>
  {% else %}
    <div class="form-grid">
      {% for category in categories %}
        <article class="card">
          <form class="inline-form" method="post" action="/categories">
            <input type="hidden" name="category_id" value="{{ category.id }}" />
            <label for="rename-{{ category.id }}">Kategorie</label>
            <input id="rename-{{ category.id }}" name="name" type="text" value="{{ category.name }}" required />
            <button class="button secondary small" type="submit">Umbenennen</button>
          </form>

          <div class="category-tree__actions">
            <form class="inline-form" method="post" action="/categories/{{ category.id }}/subcategories">
              <label for="new-sub-{{ category.id }}">Unterkategorie</label>
              <input id="new-sub-{{ category.id }}" name="name" type="text" placeholder="Neue Unterkategorie" required />
              <button class="button secondary small" type="submit">Hinzufügen</button>
            </form>
            <form method="post" action="/categories/{{ category.id }}/delete" onsubmit="return confirm('Kategorie wirklich löschen? Alle Unterkategorien werden ebenfalls entfernt.');">
              <button class="button danger small" type="submit">Kategorie löschen</button>
            </form>
          </div>

          {% if category.children %}
            <ul class="category-tree" style="margin-top:1rem; border: none; box-shadow:none; padding:0;">
              {% for subcategory in category.children %}
                <li>
                  <form class="inline-form" method="post" action="/categories/{{ category.id }}/subcategories/{{ subcategory.id }}/rename">
                    <input name="name" type="text" value="{{ subcategory.name }}" required />
                    <button class="button secondary small" type="submit">Umbenennen</button>
                  </form>
                  <form method="post" action="/categories/{{ category.id }}/subcategories/{{ subcategory.id }}/delete" onsubmit="return confirm('Unterkategorie wirklich löschen?');">
                    <button class="button ghost small" type="submit">Entfernen</button>
                  </form>
                </li>
              {% endfor %}
            </ul>
          {% else %}
            <p class="text-muted" style="margin-top:1rem;">Noch keine Unterkategorien angelegt.</p>
          {% endif %}
        </article>
      {% endfor %}
    </div>
  {% endif %}
{% endblock %}
